<div class="public-booking-container">
  <div class="booking-header">
    <div class="host-info">
      <div class="host-avatar">{{ hostPhoto }}</div>
      <div>
        <h1>Book time with {{ hostName }}</h1>
        <p>Select an available time slot below</p>
      </div>
    </div>
  </div>

  @if (step === 'slots') {
    <div class="slots-section">
      @if (loading) {
        <div class="loading">Loading available slots...</div>
      } @else {
        @for (group of groupSlotsByDate(); track group.date) {
          <div class="date-group">
            <h3 class="date-header">{{ group.date }}</h3>
            <div class="slots-grid">
              @for (slot of group.slots; track slot.id) {
                <button
                  class="slot-btn"
                  [class.available]="slot.available"
                  [class.unavailable]="!slot.available"
                  [disabled]="!slot.available"
                  (click)="selectSlot(slot)"
                >
                  {{ formatTime(slot.start) }}
                </button>
              }
            </div>
          </div>
        }
      }
    </div>
  }

  @if (step === 'form') {
    <div class="form-section">
      <button class="back-btn" (click)="step = 'slots'">← Back to slots</button>
      
      <div class="selected-slot-info">
        <h3>Selected Time</h3>
        <div class="slot-details">
          <span class="slot-date">{{ formatDate(selectedSlot!.start) }}</span>
          <span class="slot-time">{{ formatTime(selectedSlot!.start) }}</span>
        </div>
      </div>

      <form (ngSubmit)="submitBooking()" class="booking-form">
        <div class="form-group">
          <label for="name">Your Name</label>
          <input
            type="text"
            id="name"
            [(ngModel)]="guestName"
            name="name"
            placeholder="John Doe"
            required
          />
        </div>

        <div class="form-group">
          <label for="email">Email Address</label>
          <input
            type="email"
            id="email"
            [(ngModel)]="guestEmail"
            name="email"
            placeholder="john@example.com"
            required
          />
        </div>

        <div class="form-group">
          <label for="reason">Reason for Meeting</label>
          <textarea
            id="reason"
            [(ngModel)]="reason"
            name="reason"
            rows="4"
            placeholder="What would you like to discuss?"
            required
          ></textarea>
        </div>

        <button type="submit" class="submit-btn" [disabled]="submitting || !guestName || !guestEmail || !reason">
          {{ submitting ? 'Booking...' : 'Confirm Booking' }}
        </button>
      </form>
    </div>
  }

  @if (step === 'conflict') {
    <div class="conflict-section">
      <div class="conflict-icon">⚠️</div>
      <h2>This slot was just booked</h2>
      <p>Someone else just booked this time. Here are some alternative slots:</p>

      <div class="alternatives-grid">
        @for (slot of alternativeSlots; track slot.id) {
          <button class="alternative-slot" (click)="selectAlternative(slot)">
            <div class="alt-date">{{ formatDate(slot.start) }}</div>
            <div class="alt-time">{{ formatTime(slot.start) }}</div>
          </button>
        }
      </div>

      <button class="waitlist-btn" (click)="showWaitlist()">
        None of these work? Join the waitlist
      </button>
    </div>
  }

  @if (step === 'waitlist') {
    <div class="waitlist-section">
      <h2>Join the Waitlist</h2>
      <p>We'll email you the moment a slot opens up in your preferred time window</p>

      <form (ngSubmit)="submitWaitlist()" class="waitlist-form">
        <div class="form-group">
          <label for="wl-name">Your Name</label>
          <input
            type="text"
            id="wl-name"
            [(ngModel)]="guestName"
            name="wl-name"
            placeholder="John Doe"
            required
          />
        </div>

        <div class="form-group">
          <label for="wl-email">Email Address</label>
          <input
            type="email"
            id="wl-email"
            [(ngModel)]="guestEmail"
            name="wl-email"
            placeholder="john@example.com"
            required
          />
        </div>

        <div class="form-group">
          <label for="wl-reason">Reason for Meeting</label>
          <textarea
            id="wl-reason"
            [(ngModel)]="reason"
            name="wl-reason"
            rows="3"
            placeholder="What would you like to discuss?"
            required
          ></textarea>
        </div>

        <div class="form-group">
          <label for="time-window">Preferred Time Window</label>
          <input
            type="text"
            id="time-window"
            [(ngModel)]="preferredTimeWindow"
            name="time-window"
            placeholder="e.g., mornings this week, afternoons next week"
            required
          />
        </div>

        <button type="submit" class="submit-btn" [disabled]="submitting">
          {{ submitting ? 'Joining...' : 'Join Waitlist' }}
        </button>
      </form>
    </div>
  }

  @if (step === 'success') {
    <div class="success-section">
      <div class="success-icon">✅</div>
      <h2>You're all set!</h2>
      <p>Your meeting with {{ hostName }} has been confirmed</p>
      
      <div class="confirmation-details">
        <div class="detail-row">
          <span class="label">Date:</span>
          <span class="value">{{ formatDate(selectedSlot!.start) }}</span>
        </div>
        <div class="detail-row">
          <span class="label">Time:</span>
          <span class="value">{{ formatTime(selectedSlot!.start) }}</span>
        </div>
        <div class="detail-row">
          <span class="label">Duration:</span>
          <span class="value">30 minutes</span>
        </div>
      </div>

      <p class="confirmation-note">A confirmation email has been sent to {{ guestEmail }}</p>
    </div>
  }
</div>
